<!-- pages/dashboard.html -->
<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Dashboard - Frontend Template Pro">
  
  <title>Dashboard - Template Pro</title>
  
  <!-- Preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="../assets/css/main.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="../assets/icons/favicon.svg">
  
  <!-- Import Maps -->
  <script type="importmap">
    {
      "imports": {
        "apexcharts": "https://cdn.jsdelivr.net/npm/apexcharts@3.45.0/dist/apexcharts.esm.js"
      }
    }
  </script>
  
  <!-- Main app -->
  <script type="module" src="../assets/js/main.js"></script>
</head>

<body data-page="dashboard">
  <!-- Skip to main -->
  <a href="#main-content" class="skip-link">Saltar al contenido</a>
  
  <!-- Header -->
  <app-header fixed></app-header>
  
  <!-- Main Content -->
  <main id="main-content">
    <div class="container">
      <!-- Page Header -->
      <div class="py-8">
        <h1>Dashboard</h1>
        <p class="text-secondary">Resumen de tu actividad y métricas principales</p>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <!-- Stat Card 1 -->
        <div class="card">
          <div class="card__body">
            <div class="d-flex justify-between align-center mb-4">
              <span class="text-sm text-secondary">Total Usuarios</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-primary">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <div class="text-3xl font-bold mb-2">2,543</div>
            <div class="d-flex align-center gap-2">
              <span class="badge badge--success">+12.5%</span>
              <span class="text-xs text-tertiary">vs mes anterior</span>
            </div>
          </div>
        </div>

        <!-- Stat Card 2 -->
        <div class="card">
          <div class="card__body">
            <div class="d-flex justify-between align-center mb-4">
              <span class="text-sm text-secondary">Ingresos</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-success">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
            </div>
            <div class="text-3xl font-bold mb-2">€45,231</div>
            <div class="d-flex align-center gap-2">
              <span class="badge badge--success">+8.2%</span>
              <span class="text-xs text-tertiary">vs mes anterior</span>
            </div>
          </div>
        </div>

        <!-- Stat Card 3 -->
        <div class="card">
          <div class="card__body">
            <div class="d-flex justify-between align-center mb-4">
              <span class="text-sm text-secondary">Conversiones</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-warning">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
              </svg>
            </div>
            <div class="text-3xl font-bold mb-2">3.2%</div>
            <div class="d-flex align-center gap-2">
              <span class="badge badge--error">-2.4%</span>
              <span class="text-xs text-tertiary">vs mes anterior</span>
            </div>
          </div>
        </div>

        <!-- Stat Card 4 -->
        <div class="card">
          <div class="card__body">
            <div class="d-flex justify-between align-center mb-4">
              <span class="text-sm text-secondary">Sesiones</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-info">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </div>
            <div class="text-3xl font-bold mb-2">12,543</div>
            <div class="d-flex align-center gap-2">
              <span class="badge badge--success">+18.7%</span>
              <span class="text-xs text-tertiary">vs mes anterior</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Revenue Chart -->
        <div class="card">
          <div class="card__header">
            <h3 class="card__title">Ingresos Mensuales</h3>
          </div>
          <div class="card__body">
            <div id="revenue-chart" data-chart='{"type":"area"}'></div>
          </div>
        </div>

        <!-- Users Chart -->
        <div class="card">
          <div class="card__header">
            <h3 class="card__title">Usuarios por Dispositivo</h3>
          </div>
          <div class="card__body">
            <div id="device-chart" data-chart='{"type":"donut"}'></div>
          </div>
        </div>
      </div>

      <!-- Data Table -->
      <div class="card mb-8">
        <div class="card__header">
          <h3 class="card__title">Transacciones Recientes</h3>
        </div>
        <div class="card__body p-0">
          <div id="transactions-table" data-datatable></div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>
  </main>
  
  <!-- Footer -->
  <app-footer></app-footer>
  
  <!-- Initialize Dashboard -->
  <script type="module">
    import { ChartManager } from '../assets/js/modules/charts/chart-manager.js';
    import { DataTable } from '../assets/js/modules/datatable/datatable.js';

    // Wait for app to be ready
    window.addEventListener('load', async () => {
      await window.app.ready;

      // Initialize Revenue Chart
      await ChartManager.createPreset('area', '#revenue-chart', {
        series: [{
          name: 'Ingresos',
          data: [12000, 19000, 15000, 21000, 28000, 35000, 45000, 38000, 42000, 48000, 52000, 58000]
        }],
        categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic']
      });

      // Initialize Device Chart
      await ChartManager.createPreset('donut', '#device-chart', {
        series: [44, 33, 23],
        labels: ['Desktop', 'Mobile', 'Tablet']
      });

      // Initialize DataTable
      new DataTable('#transactions-table', {
        columns: [
          { key: 'id', label: 'ID' },
          { key: 'customer', label: 'Cliente' },
          { key: 'amount', label: 'Monto', format: 'currency' },
          { key: 'status', label: 'Estado', render: (value) => {
            const variants = {
              'completed': 'success',
              'pending': 'warning',
              'failed': 'error'
            };
            return `<span class="badge badge--${variants[value]}">${value}</span>`;
          }},
          { key: 'date', label: 'Fecha', format: 'date' }
        ],
        data: [
          { id: '001', customer: 'Juan Pérez', amount: 1250, status: 'completed', date: '2024-12-08' },
          { id: '002', customer: 'María García', amount: 890, status: 'completed', date: '2024-12-08' },
          { id: '003', customer: 'Carlos López', amount: 2100, status: 'pending', date: '2024-12-07' },
          { id: '004', customer: 'Ana Martínez', amount: 750, status: 'completed', date: '2024-12-07' },
          { id: '005', customer: 'Luis Rodríguez', amount: 1500, status: 'failed', date: '2024-12-06' },
          { id: '006', customer: 'Sofia Fernández', amount: 3200, status: 'completed', date: '2024-12-06' },
          { id: '007', customer: 'Diego Torres', amount: 980, status: 'pending', date: '2024-12-05' },
          { id: '008', customer: 'Laura Sánchez', amount: 1850, status: 'completed', date: '2024-12-05' },
          { id: '009', customer: 'Miguel Ramírez', amount: 640, status: 'completed', date: '2024-12-04' },
          { id: '010', customer: 'Carmen Díaz', amount: 2450, status: 'completed', date: '2024-12-04' }
        ],
        pageSize: 5,
        sortable: true,
        searchable: true
      });

      // Show welcome notification
      setTimeout(() => {
        const toast = document.createElement('app-toast');
        toast.setAttribute('type', 'success');
        toast.setAttribute('duration', '5000');
        toast.innerHTML = `
          <div slot="title">¡Bienvenido!</div>
          <div slot="message">Dashboard cargado correctamente</div>
        `;
        document.getElementById('toast-container').appendChild(toast);
      }, 500);
    });
  </script>
  <!-- Añadir al dashboard después de window.app.ready -->
<script type="module">
  // Cargar datos del backend
  const { api } = await import('../assets/js/core/api.js');
  const stats = await api.get('/dashboard/stats');
  
  // Usar traducciones
  const { t } = window.app;
  document.querySelector('h1').textContent = t('dashboard.title');
</script>
</body>
</html>